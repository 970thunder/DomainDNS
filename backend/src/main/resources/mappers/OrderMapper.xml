<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.domaindns.admin.mapper.OrderMapper">
	<resultMap id="OrderMap" type="com.domaindns.admin.model.PaymentOrder">
		<id property="id" column="id" />
		<result property="userId" column="user_id" />
		<result property="orderNo" column="order_no" />
		<result property="amountDecimal" column="amount_decimal" />
		<result property="points" column="points" />
		<result property="status" column="status" />
		<result property="provider" column="provider" />
		<result property="providerTxnId" column="provider_txn_id" />
		<result property="createdAt" column="created_at" />
	</resultMap>

	<select id="list" resultMap="OrderMap">
		SELECT id,user_id,order_no,amount_decimal,points,status,provider,provider_txn_id,created_at FROM payment_orders
		<where>
			<if test="status!=null and status!=''">status=#{status}</if>
			<if test="userId!=null">
				<if test="status!=null and status!=''"> AND </if>
				user_id=#{userId}
			</if>
		</where>
		ORDER BY id DESC
		<if test="size!=null"> LIMIT #{offset}, #{size}</if>
	</select>

	<select id="count" resultType="int">
		SELECT COUNT(1) FROM payment_orders
		<where>
			<if test="status!=null and status!=''">status=#{status}</if>
			<if test="userId!=null">
				<if test="status!=null and status!=''"> AND </if>
				user_id=#{userId}
			</if>
		</where>
	</select>

	<insert id="insert">
		INSERT INTO payment_orders(user_id,order_no,amount_decimal,points,status,provider)
		VALUES(#{userId},#{orderNo},#{amountDecimal},#{points},'PENDING',#{provider})
	</insert>
</mapper>
